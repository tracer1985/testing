---
- name: Kill netcat, switch to webadm, and start netcat
  hosts: all
  become: true
  tasks:
    - name: Kill all running netcat (nc) processes
      shell: pgrep nc | xargs --no-run-if-empty kill -9
      ignore_errors: true

    - name: Start netcat as webadm (example: listening on port 9999)
      become: true
      become_user: webadm
      shell: nohup nc -l -p 8080 > /tmp/nc_output.log 2>&1 &
      args:
        executable: /bin/bash
